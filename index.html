<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Meter Search</title>
</head>
<body style="display: block;text-align: center;margin: 0 auto;width: 100%;font-size: 25px;font-weight: bold;">

<h3>‡®á‡©±‡®•‡©á ‡®∏‡©Ä‡®∞‡®ø‡®≤ ‡®®‡©∞‡®¨‡®∞ ‡®≠‡®∞‡®¶‡©á</h3>

<input type="text" id="search" placeholder="Enter Meter Serial Number">
<button onclick="search()">Search</button>

<pre id="result"></pre>

<script>
/* üî• MUST be at top (GLOBAL) */
let data = [];
let loaded = false;

/* CSV LOAD */
fetch("data.csv")
  .then(res => res.text())
  .then(text => {
    let rows = text
      .replace(/\uFEFF/g,"")
      .trim()
      .split("\n")
      .slice(1);

    rows.forEach(r => {
      let c = r.split(",").map(x =>
        x.replace(/"/g,"").replace(/\r/g,"").trim()
      );

      if (c.length >= 5) {
        data.push({
          acct: c[0],
          legacy: c[1],
          name: c[2],
          address: c[3],
          meter: c[4].replace(/\D/g,"") // digits only
        });
      }
    });

    loaded = true; // ‚úÖ IMPORTANT
    document.getElementById("result").textContent = "‚úÖ Data ready";
    console.log("Loaded rows:", data.length);
  });

/* SEARCH */
function search() {
  let out = document.getElementById("result");

  if (!loaded) {
    out.textContent = "‚è≥ Data load ho rahi aa‚Ä¶";
    return;
  }

  let input = document.getElementById("search").value;
  let userDigits = input.replace(/\D/g,"");

  if (!userDigits) {
    out.textContent = "‚ùå Meter serial number bharo";
    return;
  }

  // 1Ô∏è‚É£ Exact match
  let exact = data.find(d => d.meter === userDigits);
  if (exact) return show(exact);

  // 2Ô∏è‚É£ Ends-with match
  let ends = data
    .filter(d => d.meter.endsWith(userDigits))
    .sort((a,b) => b.meter.length - a.meter.length)[0];
  if (ends) return show(ends);

  // 3Ô∏è‚É£ Contains match
  let contains = data
    .filter(d => d.meter.includes(userDigits))
    .sort((a,b) => b.meter.length - a.meter.length)[0];
  if (contains) return show(contains);

  out.textContent = "‚ùå ‡®π‡©à ‡®®‡©Ä ‡®≠‡®∞‡®æ‡®µ‡®æ ‡®ï‡©Å‡®ù ‡®ú‡®æ ‡®ï‡©á ‡®°‡®µ‡©Ä‡©õ‡®® ‡®ö‡©ã‡®Ç ‡®¨‡®£‡®µ‡®æ‡®≤‡®æ ‡®¨‡®ø‡©±‡®≤ ‡®á‡®π‡®¶‡®æ";
}

/* OUTPUT */
function show(found) {
  document.getElementById("result").textContent =
    "Account ID: " + found.acct + "\n" +
    "Legacy Account: " + found.legacy + "\n" +
    "Name: " + found.name + "\n" +
    "Address: " + found.address;
}
</script>



<!-- <script>
let data = [];
let loaded = false;   // üî• load flag

fetch("data.csv")
  .then(res => res.text())
  .then(text => {
    let rows = text.trim().split("\n").slice(1);

    rows.forEach(r => {
      let c = r.split(",").map(x =>
        x.replace(/"/g, "").replace(/\r/g, "").trim()
      );

      if (c.length >= 5) {
        data.push({
          acct: c[0],
          legacy: c[1],
          name: c[2],
          address: c[3],
          meter: c[4]   // ‚úÖ CLEANED
        });
      }
    });

    loaded = true;
    console.log("CSV loaded:", data.length);
    document.getElementById("result").textContent = "‚úÖ Data ready";
  });

function search() {
  let out = document.getElementById("result");

  if (!loaded) {
    out.textContent = "‚è≥ Data load ho rahi aa‚Ä¶ 1 sec ruk";
    return;
  }

  let val = document.getElementById("search").value
              .replace(/\s+/g, "")
              .replace(/\r/g, "")
              .trim();

  let found = data.find(d => d.meter === val);

  if (found) {
    out.textContent =
      "Account ID: " + found.acct + "\n" +
      "Legacy Account: " + found.legacy + "\n" +
      "Name: " + found.name + "\n" +
      "Address: " + found.address;
  } else {
    out.textContent = "‚ùå ‡®π‡©à ‡®®‡©Ä ‡®≠‡®∞‡®æ‡®µ‡®æ ‡®ï‡©Å‡®ù ‡®ú‡®æ ‡®ï‡©á ‡®°‡®µ‡©Ä‡©õ‡®® ‡®ö‡©ã‡®Ç ‡®¨‡®£‡®µ‡®æ‡®≤‡®æ ‡®¨‡®ø‡©±‡®≤ ‡®á‡®π‡®¶‡®æ";
  }
}
</script> -->




</body>
</html>
