<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Meter Search</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body style="display: block;text-align: center;margin: 0 auto;width: 100%;font-size: 25px;font-weight: bold;">

<h3>ਇੱਥੇ ਸੀਰਿਲ ਨੰਬਰ ਭਰੋ</h3>

<input type="text" id="search" placeholder="Enter Meter Serial Number">
<button onclick="search()">Search</button>

<pre id="result" style="margin-top: 20px; font-family: sans-serif;"></pre>

<script>
let data = [];
let loaded = false;

fetch("data.csv")
  .then(res => res.text())
  .then(text => {
    // Remove BOM and split rows
    let rows = text.replace(/\uFEFF/g,"").trim().split("\n").slice(1);

    rows.forEach(r => {
      // Basic split by comma
      let c = r.split(",");
      
      if (c.length >= 5) {
        // The meter serial number is always the LAST column
        let rawMeter = c[c.length - 1].replace(/"/g,"").trim();
        // Extract only digits for searching
        let meterDigits = rawMeter.replace(/\D/g,"");

        // The address is everything between column 3 and the last column
        let addressPart = c.slice(3, -1).join(",").replace(/"/g, "").trim();

        data.push({
          acct: c[0].replace(/"/g,"").trim(),
          legacy: c[1].replace(/"/g,"").trim(),
          name: c[2].replace(/"/g,"").trim(),
          address: addressPart,
          meter: meterDigits
        });
      }
    });

    loaded = true;
    document.getElementById("result").textContent = "✅ Data ready (" + data.length + " records)";
  })
  .catch(err => {
    document.getElementById("result").textContent = "❌ Error loading CSV";
    console.error(err);
  });

function search() {
  let out = document.getElementById("result");

  if (!loaded) {
    out.textContent = "⏳ Data load ho rahi aa…";
    return;
  }

  let input = document.getElementById("search").value;
  let userDigits = input.replace(/\D/g, "");

  if (!userDigits) {
    out.textContent = "❌ Meter serial number bharo";
    return;
  }

  // 1. Use .filter() instead of .find() to get ALL matches
  let matches = data.filter(d => 
    d.meter !== "" && d.meter.includes(userDigits)
  );

  if (matches.length > 0) {
    // 2. Map through the matches to create a formatted string for each
    let resultsText = matches.map((found, index) => {
      return `--- Result ${index + 1} ---\n` +
             `Account ID: ${found.acct}\n` +
             `Legacy Account: ${found.legacy}\n` +
             `Name: ${found.name}\n` +
             `Address: ${found.address}\n` +
             `Meter: ${found.meter}\n`;
    }).join("\n"); // Join them with an extra newline for spacing

    out.textContent = resultsText;
  } else {
    out.textContent = "❌ ਡਵੀਜ਼ਨ ਚੋਂ ਜਾ ਕੇ ਬਿੱਲ ਬਣਵਾਓ";
  }
}
</script>


                 <script>
                    (function () {
                        // Function to check if the user is on a mobile device
                        const isMobile = /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
                
                        if (!isMobile) { // Run the code ONLY if the user is NOT on a mobile device
                            // Disable right-click
                            document.addEventListener("contextmenu", (event) => {
                                event.preventDefault();
                                alert("Right-click is disabled on this website.");
                            });
                
                            // Disable specific keyboard shortcuts
                            document.addEventListener("keydown", (event) => {
                                // Block F12
                                if (event.key === "F12") {
                                    event.preventDefault();
                                    alert("Developer tools are disabled for this website.");
                                }
                
                                // Block Ctrl+Shift+I and Ctrl+Shift+J
                                if (event.ctrlKey && event.shiftKey && ["I", "J"].includes(event.key.toUpperCase())) {
                                    event.preventDefault();
                                    alert("Developer tools are disabled for this website.");
                                }
                
                                // Block Ctrl+U (View Source)
                                if (event.ctrlKey && event.key.toUpperCase() === "U") {
                                    event.preventDefault();
                                    alert("Viewing source code is disabled for this website.");
                                }
                            });
                
                            // Detect Developer Tools Opening
                            const detectDevTools = () => {
                                const threshold = 160; // Threshold for detecting dev tools
                                const devToolsOpen =
                                    window.outerWidth - window.innerWidth > threshold ||
                                    window.outerHeight - window.innerHeight > threshold;
                
                                if (devToolsOpen) {
                                    alert("Developer tools are disabled for this website. Please close them.");
                                }
                            };
                
                            setInterval(detectDevTools, 1000); // Run detection every second
                        }
                    })();
                </script>


</body>
</html>